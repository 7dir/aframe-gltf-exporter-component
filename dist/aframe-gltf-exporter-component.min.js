!function(e){function r(a){if(t[a])return t[a].exports;var n=t[a]={exports:{},id:a,loaded:!1};return e[a].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){if("undefined"==typeof AFRAME)throw new Error("Component attempted to register before AFRAME was available.");t(1),AFRAME.registerSystem("gltf-exporter",{schema:{verbose:{default:!1}},multiple:!1,init:function(){this.link=document.createElement("a"),this.link.style.display="none",document.body.appendChild(this.link),this.exporter=new THREE.GLTFExporter},download:function(e,r){this.link.href=URL.createObjectURL(e),this.link.download=r,this.link.click()},downloadJSON:function(e,r){this.download(new Blob([e],{type:"application/json"}),r)},export:function(e,r){var t;t="undefined"==typeof e?this.sceneEl.object3D:e instanceof Array?e.map(function(e){return e.object3D}):e instanceof NodeList?Array.prototype.slice.call(e).map(function(e){return e.object3D}):e.object3D;var a=this;this.exporter.parse(t,function(e){var r=JSON.stringify(e,null,2);a.data.verbose&&console.log(r),a.downloadJSON(r,"scene.gltf")},r)}})},function(e,r){var t={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123,FLOAT:5126,UNSIGNED_INT:5125,ARRAY_BUFFER:34962,ELEMENT_ARRAY_BUFFER:34963,NEAREST:9728,LINEAR:9729,NEAREST_MIPMAP_NEAREST:9984,LINEAR_MIPMAP_NEAREST:9985,NEAREST_MIPMAP_LINEAR:9986,LINEAR_MIPMAP_LINEAR:9987},a={1003:t.NEAREST,1004:t.NEAREST_MIPMAP_NEAREST,1005:t.NEAREST_MIPMAP_LINEAR,1006:t.LINEAR,1007:t.LINEAR_MIPMAP_NEAREST,1008:t.LINEAR_MIPMAP_LINEAR};THREE.GLTFExporter=function(){},THREE.GLTFExporter.prototype={constructor:THREE.GLTFExporter,parse:function(e,r,n){function i(e,r){return e.length===r.length&&e.every(function(e,t){return e===r[t]})}function s(e){for(var r={min:new Array(e.itemSize).fill(Number.POSITIVE_INFINITY),max:new Array(e.itemSize).fill(Number.NEGATIVE_INFINITY)},t=0;t<e.count;t++)for(var a=0;a<e.itemSize;a++){var n=e.array[t*e.itemSize+a];r.min[a]=Math.min(r.min[a],n),r.max[a]=Math.max(r.max[a],n)}return r}function o(e,r,a,n){N.buffers||(N.buffers=[{byteLength:0,uri:""}]);for(var i=0,s=r===t.UNSIGNED_SHORT?2:4,o=n*e.itemSize*s,l=new DataView(new ArrayBuffer(o)),c=a;c<a+n;c++)for(var u=0;u<e.itemSize;u++){var E=e.array[c*e.itemSize+u];r===t.FLOAT?l.setFloat32(i,E,!0):r===t.UNSIGNED_INT?l.setUint8(i,E,!0):r===t.UNSIGNED_SHORT&&l.setUint16(i,E,!0),i+=s}return v.push(l),0}function l(e,r,a,n){var i=r===t.FLOAT;N.bufferViews||(N.bufferViews=[]);var s=r===t.UNSIGNED_SHORT?2:4,l=n*e.itemSize*s,c={buffer:o(e,r,a,n),byteOffset:A,byteLength:l,byteStride:e.itemSize*s,target:i?t.ARRAY_BUFFER:t.ELEMENT_ARRAY_BUFFER};A+=l,N.bufferViews.push(c);var u={id:N.bufferViews.length-1,byteLength:0};return u}function c(e,r){N.accessors||(N.accessors=[]);var a,i=["SCALAR","VEC2","VEC3","VEC4"];if(e.array.constructor===Float32Array)a=t.FLOAT;else if(e.array.constructor===Uint32Array)a=t.UNSIGNED_INT;else{if(e.array.constructor!==Uint16Array)throw new Error("THREE.GLTFExporter: Unsupported bufferAttribute component type.");a=t.UNSIGNED_SHORT}var o=s(e),c=0,u=e.count;n.truncateDrawRange&&null===r.index&&(c=r.drawRange.start,u=r.drawRange.count!==1/0?r.drawRange.count:e.count);var E=l(e,a,c,u),f={bufferView:E.id,byteOffset:E.byteOffset,componentType:a,count:u,max:o.max,min:o.min,type:i[e.itemSize-1]};return N.accessors.push(f),N.accessors.length-1}function u(e){if(I.images[e.uuid])return I.images[e.uuid];N.images||(N.images=[]);var r={};n.embedImages||(r.uri=e.image.src),N.images.push(r);var t=N.images.length-1;return I.images[e.uuid]=t,t}function E(e){N.samplers||(N.samplers=[]);var r={magFilter:a[e.magFilter],minFilter:a[e.minFilter],wrapS:a[e.wrapS],wrapT:a[e.wrapT]};return N.samplers.push(r),N.samplers.length-1}function f(e){N.textures||(N.textures=[]);var r={sampler:E(e),source:u(e)};return N.textures.push(r),N.textures.length-1}function m(e){if(I.materials[e.uuid])return I.materials[e.uuid];if(N.materials||(N.materials=[]),e instanceof THREE.ShaderMaterial)return console.warn("GLTFExporter: THREE.ShaderMaterial not supported."),null;e instanceof THREE.MeshStandardMaterial||console.warn("GLTFExporter: Currently just THREE.StandardMaterial is supported. Material conversion may lose information.");var r={pbrMetallicRoughness:{}},t=e.color.toArray().concat([e.opacity]);if(i(t,[1,1,1,1])||(r.pbrMetallicRoughness.baseColorFactor=t),e instanceof THREE.MeshStandardMaterial?(r.pbrMetallicRoughness.metallicFactor=e.metalness,r.pbrMetallicRoughness.roughnessFactor=e.roughness):(r.pbrMetallicRoughness.metallicFactor=.5,r.pbrMetallicRoughness.roughnessFactor=.5),e.map&&(r.pbrMetallicRoughness.baseColorTexture={index:f(e.map)}),e instanceof THREE.MeshBasicMaterial||e instanceof THREE.LineBasicMaterial||e instanceof THREE.PointsMaterial);else{var a=e.emissive.clone().multiplyScalar(e.emissiveIntensity).toArray();i(a,[0,0,0])||(r.emissiveFactor=a),e.emissiveMap&&(r.emissiveTexture={index:f(e.emissiveMap)})}e.normalMap&&(r.normalTexture={index:f(e.normalMap)},e.normalScale.x!==-1&&(e.normalScale.x!==e.normalScale.y&&console.warn("GLTFExporter: Normal scale components are different, ignoring Y and exporting X"),r.normalTexture.scale=e.normalScale.x)),e.aoMap&&(r.occlusionTexture={index:f(e.aoMap)},1!==e.aoMapIntensity&&(r.occlusionTexture.strength=e.aoMapIntensity)),e.transparent&&(r.alphaMode="MASK",.5!==e.alphaTest&&(r.alphaCutoff=e.alphaTest)),e.side===THREE.DoubleSide&&(r.doubleSided=!0),e.name&&(r.name=e.name),N.materials.push(r);var n=N.materials.length-1;return I.materials[e.uuid]=n,n}function p(e){N.meshes||(N.meshes=[]);var r,a=e.geometry;if(e instanceof THREE.LineSegments)r=t.LINES;else if(e instanceof THREE.LineLoop)r=t.LINE_LOOP;else if(e instanceof THREE.Line)r=t.LINE_STRIP;else if(e instanceof THREE.Points)r=t.POINTS;else{if(!a.isBufferGeometry){var n=new THREE.BufferGeometry;n.fromGeometry(a),a=n}e.drawMode===THREE.TriangleFanDrawMode?(console.warn("GLTFExporter: TriangleFanDrawMode and wireframe incompatible."),r=t.TRIANGLE_FAN):r=e.drawMode===THREE.TriangleStripDrawMode?e.material.wireframe?t.LINE_STRIP:t.TRIANGLE_STRIP:e.material.wireframe?t.LINES:t.TRIANGLES}var i={primitives:[{mode:r,attributes:{}}]},s=m(e.material);null!==s&&(i.primitives[0].material=s),a.index&&(i.primitives[0].indices=c(a.index,a));var o=i.primitives[0].attributes,l=a.attributes,u={uv:"TEXCOORD_0",uv2:"TEXCOORD_1",color:"COLOR_0",skinWeight:"WEIGHTS_0",skinIndex:"JOINTS_0"};for(var E in l){var f=l[E];E=u[E]||E.toUpperCase(),o[E]=c(f,a)}return N.meshes.push(i),N.meshes.length-1}function d(e){N.cameras||(N.cameras=[]);var r=e instanceof THREE.OrthographicCamera,t={type:r?"orthographic":"perspective"};return r?t.orthographic={xmag:2*e.right,ymag:2*e.top,zfar:e.far,znear:e.near}:t.perspective={aspectRatio:e.aspect,yfov:THREE.Math.degToRad(e.fov)/e.aspect,zfar:e.far,znear:e.near},e.name&&(t.name=e.type),N.cameras.push(t),N.cameras.length-1}function R(e){if(e instanceof THREE.Light)return console.warn("GLTFExporter: Unsupported node type:",e.constructor.name),!1;N.nodes||(N.nodes=[]);var r={};if(n.trs){var t=e.quaternion.toArray(),a=e.position.toArray(),s=e.scale.toArray();i(t,[0,0,0,1])||(r.rotation=t),i(a,[0,0,0])||(r.position=a),i(s,[1,1,1])||(r.scale=s)}else e.updateMatrix(),i(e.matrix.elements,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])||(r.matrix=e.matrix.elements);if(e.name&&(r.name=e.name),e.userData&&Object.keys(e.userData).length>0)try{r.extras=JSON.parse(JSON.stringify(e.userData))}catch(e){throw new Error("GLTFExporter: userData can't be serialized")}if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Points?r.mesh=p(e):e instanceof THREE.Camera&&(r.camera=d(e)),e.children.length>0){for(var o=[],l=0,c=e.children.length;l<c;l++){var u=e.children[l];if(u.visible||n.onlyVisible===!1){var E=R(u);E!==!1&&o.push(E)}}o.length>0&&(r.children=o)}return N.nodes.push(r),N.nodes.length-1}function T(e){N.scenes||(N.scenes=[],N.scene=0);var r={nodes:[]};e.name&&(r.name=e.name),N.scenes.push(r);for(var t=[],a=0,i=e.children.length;a<i;a++){var s=e.children[a];if(s.visible||n.onlyVisible===!1){var o=R(s);o!==!1&&t.push(o)}}t.length>0&&(r.nodes=t)}function h(e){var r=new THREE.Scene;r.name="AuxScene";for(var t=0;t<e.length;t++)r.children.push(e[t]);T(r)}function g(e){e=e instanceof Array?e:[e];for(var r=[],t=0;t<e.length;t++)e[t]instanceof THREE.Scene?T(e[t]):r.push(e[t]);r.length>0&&h(r)}var S={trs:!1,onlyVisible:!0,truncateDrawRange:!0};n=Object.assign({},S,n);var N={asset:{version:"2.0",generator:"THREE.JS GLTFExporter"}},A=0,v=[],I={images:{},materials:{}};g(e);var y=new Blob(v,{type:"application/octet-stream"});if(N.buffers&&N.buffers.length>0){N.buffers[0].byteLength=y.size;var b=new window.FileReader;b.readAsDataURL(y),b.onloadend=function(){base64data=b.result,N.buffers[0].uri=base64data,r(N)}}else r(N)}}}]);